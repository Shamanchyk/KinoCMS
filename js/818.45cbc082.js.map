{"version":3,"file":"js/818.45cbc082.js","mappings":"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","sources":["webpack://kinocms/./src/views/Admin/BannerVue.vue","webpack://kinocms/./src/views/Admin/BannerVue.vue?9a0a"],"sourcesContent":["<template>\r\n    <div class=\"container\">\r\n    <div class=\"card card-primary\">\r\n      <div class=\"card-header\">\r\n        <h3 class=\"card-title\">На головній сторінці зверху</h3>\r\n      </div>\r\n      <form @submit.prevent=\"saveBaner\">\r\n        <div class=\"card-body\">\r\n          <div class=\"file-input\" v-if=\"doneTop === false\">\r\n              <input type=\"file\" ref=\"fileInput2\" class=\"input-baner\" @change=\"handleFileChange\" multiple>\r\n              <button @click=\"triggerFileInput\" class=\"btn btn-baner btn-default\" v-if=\"banerTop.length === 0\">Добавити1</button>\r\n              <div class=\"delete-img\" v-if=\"banerTop.length >= 1\">\r\n                <div class=\"image-delete\" v-for=\"(banerTopImg, i) in banerTop\" :key=\"i\">\r\n                  <img :src=\"banerTopImg\" class=\"imgInput\" v-if=\"banerTopImg\">\r\n                  <span class=\"deleteSpan\" v-if=\"banerTopImg\" @click=\"deleteBanerTop(i)\">x</span>\r\n                </div>\r\n                <button @click=\"triggerFileInput\" class=\"btn btn-block btn-default\"  v-if=\"banerTop.length >= 1\">Добавити1</button>\r\n              </div>\r\n          </div>\r\n          <div class=\"file-input\" v-if=\"doneTop === true\">\r\n              <input type=\"file\" ref=\"fileInput22\" class=\"input-baner\" @change=\"handleFileChange\" multiple>\r\n              <div class=\"delete-img\">\r\n                <div class=\"image-delete\" v-for=\"(banerTopImg, i) in banerTop\" :key=\"i\">\r\n                  <img :src=\"banerTopImg\" v-if=\"banerTopImg\" class=\"imgInput\">\r\n                  <span class=\"deleteSpan\" v-if=\"banerTopImg\" @click=\"deleteBannerTop(i)\">x</span>\r\n                </div>\r\n                <button @click=\"triggerFileInput\" class=\"btn btn-block btn-default\">Добавити2</button>\r\n              </div>\r\n          </div>\r\n        </div> \r\n        <div v-if=\"showMessage\" class=\"message\">\r\n          {{ message }}\r\n        </div>\r\n        <div class=\"card-footer\">\r\n          <button @click=\"saveBaner\" class=\"btn btn-primary\" type=\"submit\">Зберегти</button>\r\n        </div>\r\n      </form>\r\n    </div>\r\n  </div>\r\n  </template>\r\n  <script>\r\n  \r\n  import { getDatabase, ref as dbRef, set, push, update, onValue, remove, get} from 'firebase/database'\r\n  import { getStorage, ref as storRef, uploadBytes, put, getDownloadURL, deleteObject, listAll } from 'firebase/storage'\r\n  \r\n  export default {\r\n  \r\n      data(){\r\n        return{\r\n          banners: {},\r\n          banerTop: [],\r\n          fileBanerTop: [],\r\n          message: 'Збережено!',\r\n          doneTop: false,\r\n        }\r\n      },\r\n  \r\n      methods:{\r\n        handleFileChange(event) {\r\n            // this.fileBanerTop = [...event.target.files]\r\n            // for(let image of this.fileBanerTop){\r\n            //   const imageSrc = URL.createObjectURL(image)\r\n            //   this.banerTop.push(imageSrc)\r\n            // }\r\n            const files = event.target.files;\r\n\r\n          for (let i = 0; i < files.length; i++) {\r\n            const file = files[i];\r\n            const fileUrl = URL.createObjectURL(file);\r\n\r\n            this.banerTop.push(fileUrl);\r\n            this.fileBanerTop.push(file);\r\n          }\r\n        },\r\n        triggerFileInput(){\r\n          this.$refs.fileInput22.click();\r\n        },\r\n        deleteBanerTop(i){\r\n          this.banerTop.splice(i, 1)\r\n          this.fileBanerTop.splice(i, 1)\r\n        },\r\n        async deleteBannerTop(i){\r\n        //Storage\r\n          const storage = getStorage();\r\n          const fileRef = storRef(storage, `banners/bannerTop/${i}`);\r\n          try {\r\n            await deleteObject(fileRef);\r\n            console.log(`Файл з індексом ${i} успішно видалено`);\r\n          } catch (error) {\r\n            console.error(`Помилка видалення файлу з індексом ${i}:`, error);\r\n          }\r\n          //BD\r\n          const db = getDatabase();\r\n          const pathDb = `banners/bannerTop/${i}`\r\n          const itemRef = dbRef(db, pathDb);\r\n  \r\n          await remove(itemRef)\r\n            .then(() => {\r\n              console.log(\"Item successfully deleted from Realtime Database\");\r\n            })\r\n            .catch((error) => {\r\n              console.log(\"Error deleting item from Realtime Database: \", error);\r\n            });\r\n        },\r\n        async saveBaner(){\r\n          const db = getDatabase()\r\n          const storage = getStorage()\r\n  \r\n          const path = 'banners'\r\n          const moviesRef = dbRef(db, path);\r\n  \r\n          // Отримуємо всі старі картинки з бази даних\r\n          // const data = snapshot.val();\r\n          // const oldBannerTop = data?.bannerTop || [];\r\n         const snapshot = await get(moviesRef);\r\nconst oldBannerTop = (snapshot.val() && snapshot.val().bannerTop) || []\r\nconst newBannerTop = [];\r\n\r\nawait Promise.all(this.fileBanerTop.map(async (image, index) => {\r\n  const storageRef = storRef(storage, `banners/bannerTop/${index}`);\r\n  await uploadBytes(storageRef, image);\r\n  const url = await getDownloadURL(storageRef);\r\n  newBannerTop.push({ url, id: index });\r\n}));\r\n\r\nnewBannerTop.sort((a, b) => a.id - b.id);\r\n\r\nupdate(moviesRef, {\r\n  bannerTop: newBannerTop.map((image) => image.url)\r\n});\r\n\r\n\r\n\r\n          // this.fileBanerTop.forEach((banerTop, index) => {\r\n          //   const storageRef = storRef(storage, `banners/bannerTop/${index}`);\r\n          //   uploadBytes(storageRef, banerTop).then((snapshot) => {\r\n          //     getDownloadURL(snapshot.ref).then((url) => {\r\n          //       bannerTop[index] = url;\r\n          //         update(moviesRef, {\r\n          //           bannerTop\r\n          //         });\r\n          //     });\r\n          //   });\r\n          // });\r\n        },\r\n        async getBanners() {\r\n          const db = getDatabase()\r\n          const bannerRef = dbRef(db, 'banners');\r\n          await new Promise((resolve) => {\r\n            onValue(bannerRef, (snapshot) => {\r\n              if (snapshot.exists()) {\r\n                this.banners = snapshot.val();\r\n                this.doneTop = true\r\n                this.banerTop = this.banners.bannerTop\r\n              } else {\r\n                console.log('Баннер не знайдено');\r\n                this.doneTop = false\r\n              }\r\n              resolve();\r\n            });\r\n          });\r\n        },\r\n      },\r\n  \r\n      async mounted() {\r\n        await this.getBanners();\r\n      },\r\n    \r\n  }\r\n  </script>\r\n  \r\n  \r\n  <style lang=\"scss\">\r\n  \r\n  .container{\r\n    width: 70%;\r\n  }\r\n  \r\n  .upload-button {\r\n  display: inline-block;\r\n  border: 1px solid #ccc;\r\n  padding: 6px 12px;\r\n  cursor: pointer;\r\n  }\r\n  \r\n  .upload-preview {\r\n  display: inline-block;\r\n  width: 100px;\r\n  height: 100px;\r\n  border: 1px solid #ccc;\r\n  margin-left: 20px;\r\n  background-size: cover;\r\n  background-position: center;\r\n  background-repeat: no-repeat;\r\n  }\r\n  label{\r\n  display: block;\r\n  text-align: left;\r\n  }\r\n  .file-input {\r\n  position: relative;\r\n  }\r\n  .input-baner {\r\n    position: absolute;\r\n    top: 0.5rem;\r\n    left: 0;\r\n    opacity: 0;\r\n    width: 30%;\r\n    cursor: pointer;\r\n    height: 38px;\r\n  }\r\n  .btn-baner {\r\n    display: block;\r\n    width: 30%;\r\n    margin: 0.5rem 0;\r\n  }\r\n  .btn-block {\r\n    display: block;\r\n    width: 30%;\r\n  }\r\n  .imgInput{\r\n  width: 250px;\r\n  height: 250px;\r\n  display: block;\r\n  }\r\n  .image-delete_btn{\r\n  display: flex;\r\n  gap: 40px;\r\n  align-items: end;\r\n  margin-bottom: 0.5rem;\r\n  }\r\n  .delete-img{\r\n  display: flex;\r\n  flex-wrap: wrap;\r\n  gap: 20px;\r\n  align-items: end;\r\n  margin-bottom: 0.5rem;\r\n  }\r\n  .deleteSpan{\r\n  position: absolute;\r\n  top: -8px;\r\n  right: -8px;\r\n  border: 1px solid black;\r\n  background: white;\r\n  border-radius: 50%;\r\n  color: black;\r\n  width: 26px;\r\n  cursor: pointer;\r\n  }\r\n  .image-delete{\r\n  position: relative;\r\n  }\r\n  .form-main{\r\n  display: flex;\r\n  gap: 20px;\r\n  }\r\n  .form-check-input {\r\n  display: block;\r\n  }\r\n  .form-group{\r\n  \r\n  h5{\r\n    text-align: start;\r\n  }\r\n  }\r\n  .card-footer{\r\n  display: flex;\r\n  gap: 30px;\r\n  justify-content: center;\r\n  }\r\n    \r\n  </style>\r\n  ","import { render } from \"./BannerVue.vue?vue&type=template&id=5314e19c\"\nimport script from \"./BannerVue.vue?vue&type=script&lang=js\"\nexport * from \"./BannerVue.vue?vue&type=script&lang=js\"\n\nimport \"./BannerVue.vue?vue&type=style&index=0&id=5314e19c&lang=scss\"\n\nimport exportComponent from \"C:\\\\Users\\\\MrBin\\\\Desktop\\\\Front\\\\Kino_CMS\\\\kinocms\\\\node_modules\\\\vue-loader\\\\dist\\\\exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['render',render]])\n\nexport default __exports__"],"names":["class","saveBaner","doneTop","type","ref","handleFileChange","multiple","banerTop","length","triggerFileInput","banerTopImg","i","key","src","deleteBanerTop","deleteBannerTop","message","data","banners","fileBanerTop","methods","event","files","target","file","fileUrl","URL","createObjectURL","this","push","$refs","fileInput22","click","splice","async","storage","fileRef","console","log","error","db","pathDb","itemRef","then","catch","path","moviesRef","snapshot","newBannerTop","val","bannerTop","Promise","all","map","image","index","storageRef","url","id","sort","a","b","bannerRef","resolve","exists","getBanners","__exports__","render"],"sourceRoot":""}